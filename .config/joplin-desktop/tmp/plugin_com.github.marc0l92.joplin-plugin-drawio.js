!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=7)}([function(e,t){e.exports=require("crypto")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=joplin},function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentScriptType=t.SettingStorage=t.AppType=t.SettingItemType=t.ToolbarButtonLocation=t.isContextMenuItemLocation=t.MenuItemLocation=t.ModelType=t.ImportModuleOutputFormat=t.FileSystemItem=void 0,function(e){e.File="file",e.Directory="directory"}(t.FileSystemItem||(t.FileSystemItem={})),function(e){e.Markdown="md",e.Html="html"}(t.ImportModuleOutputFormat||(t.ImportModuleOutputFormat={})),function(e){e[e.Note=1]="Note",e[e.Folder=2]="Folder",e[e.Setting=3]="Setting",e[e.Resource=4]="Resource",e[e.Tag=5]="Tag",e[e.NoteTag=6]="NoteTag",e[e.Search=7]="Search",e[e.Alarm=8]="Alarm",e[e.MasterKey=9]="MasterKey",e[e.ItemChange=10]="ItemChange",e[e.NoteResource=11]="NoteResource",e[e.ResourceLocalState=12]="ResourceLocalState",e[e.Revision=13]="Revision",e[e.Migration=14]="Migration",e[e.SmartFilter=15]="SmartFilter",e[e.Command=16]="Command"}(t.ModelType||(t.ModelType={})),function(e){e.File="file",e.Edit="edit",e.View="view",e.Note="note",e.Tools="tools",e.Help="help",e.Context="context",e.NoteListContextMenu="noteListContextMenu",e.EditorContextMenu="editorContextMenu",e.FolderContextMenu="folderContextMenu",e.TagContextMenu="tagContextMenu"}(n=t.MenuItemLocation||(t.MenuItemLocation={})),t.isContextMenuItemLocation=function(e){return[n.Context,n.NoteListContextMenu,n.EditorContextMenu,n.FolderContextMenu,n.TagContextMenu].includes(e)},function(e){e.NoteToolbar="noteToolbar",e.EditorToolbar="editorToolbar"}(t.ToolbarButtonLocation||(t.ToolbarButtonLocation={})),function(e){e[e.Int=1]="Int",e[e.String=2]="String",e[e.Bool=3]="Bool",e[e.Array=4]="Array",e[e.Object=5]="Object",e[e.Button=6]="Button"}(t.SettingItemType||(t.SettingItemType={})),function(e){e.Desktop="desktop",e.Mobile="mobile",e.Cli="cli"}(t.AppType||(t.AppType={})),function(e){e[e.Database=1]="Database",e[e.File=2]="File"}(t.SettingStorage||(t.SettingStorage={})),function(e){e.MarkdownItPlugin="markdownItPlugin",e.CodeMirrorPlugin="codeMirrorPlugin"}(t.ContentScriptType||(t.ContentScriptType={}))},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isDiagramResource=t.updateDiagramResource=t.createDiagramResource=t.getDiagramResource=t.clearDiskCache=void 0;const o=i(1),r=i(6),a=i(4),s=i(5),l=o.default.require("fs-extra"),d={TempFolder:`${a.tmpdir}${s.sep}joplin-drawio-plugin${s.sep}`,DataImageRegex:/^data:image\/(?<extension>png|svg)(?:\+xml)?;base64,(?<blob>.*)/,TitlePrefix:"drawio-"};function u(){return r.v4().replace(/-/g,"")}function c(e){return d.TitlePrefix+JSON.stringify(e)}function g(e,t,i=null){return n(this,void 0,void 0,(function*(){const n=t.match(d.DataImageRegex);if(!n)throw new Error("Invalid image data");return i||(i=`${d.TempFolder}${e}.${n.groups.extension}`),yield l.writeFile(i,n.groups.blob,"base64"),i}))}t.clearDiskCache=function(){l.rmdirSync(d.TempFolder,{recursive:!0}),l.mkdirSync(d.TempFolder,{recursive:!0})},t.getDiagramResource=function(e){return n(this,void 0,void 0,(function*(){const t=yield o.default.data.get(["resources",e]),i=yield o.default.data.get(["resources",e,"file"]);if(console.log("getDiagramResource",t,i),!i.contentType.startsWith("image"))throw new Error("Invalid resource content type. The resource must be an image");let n={};try{r=t.title,n=JSON.parse(r.replace(d.TitlePrefix,""))}catch(e){console.warn("getDiagramResource - Option parsing failed:",e)}var r;return{body:`data:${i.contentType};base64,${Buffer.from(i.body).toString("base64")}`,options:n}}))},t.createDiagramResource=function(e,t){return n(this,void 0,void 0,(function*(){const i=u(),n=yield g(i,e),r=yield o.default.data.post(["resources"],null,{id:i,title:c(t)},[{path:n}]);return console.log("createdResource",r),i}))},t.updateDiagramResource=function(e,t,i){return n(this,void 0,void 0,(function*(){const e=u(),n=yield g(e,t),r=yield o.default.data.post(["resources"],null,{id:e,title:c(i)},[{path:n}]);return console.log("createdResource",r),e}))},t.isDiagramResource=function(e){return n(this,void 0,void 0,(function*(){return(yield o.default.data.get(["resources",e])).title.startsWith(d.TitlePrefix)}))}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")},function(e,t,i){"use strict";i.r(t),i.d(t,"v1",(function(){return h})),i.d(t,"v3",(function(){return w})),i.d(t,"v4",(function(){return b})),i.d(t,"v5",(function(){return S})),i.d(t,"NIL",(function(){return D})),i.d(t,"version",(function(){return x})),i.d(t,"validate",(function(){return d})),i.d(t,"stringify",(function(){return c})),i.d(t,"parse",(function(){return y}));var n=i(0),o=i.n(n);const r=new Uint8Array(256);let a=r.length;function s(){return a>r.length-16&&(o.a.randomFillSync(r),a=0),r.slice(a,a+=16)}var l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;var d=function(e){return"string"==typeof e&&l.test(e)};const u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).substr(1));var c=function(e,t=0){const i=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!d(i))throw TypeError("Stringified UUID is invalid");return i};let g,f,p=0,m=0;var h=function(e,t,i){let n=t&&i||0;const o=t||new Array(16);let r=(e=e||{}).node||g,a=void 0!==e.clockseq?e.clockseq:f;if(null==r||null==a){const t=e.random||(e.rng||s)();null==r&&(r=g=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==a&&(a=f=16383&(t[6]<<8|t[7]))}let l=void 0!==e.msecs?e.msecs:Date.now(),d=void 0!==e.nsecs?e.nsecs:m+1;const u=l-p+(d-m)/1e4;if(u<0&&void 0===e.clockseq&&(a=a+1&16383),(u<0||l>p)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=l,m=d,f=a,l+=122192928e5;const h=(1e4*(268435455&l)+d)%4294967296;o[n++]=h>>>24&255,o[n++]=h>>>16&255,o[n++]=h>>>8&255,o[n++]=255&h;const y=l/4294967296*1e4&268435455;o[n++]=y>>>8&255,o[n++]=255&y,o[n++]=y>>>24&15|16,o[n++]=y>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(let e=0;e<6;++e)o[n+e]=r[e];return t||c(o)};var y=function(e){if(!d(e))throw TypeError("Invalid UUID");let t;const i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i};var v=function(e,t,i){function n(e,n,o,r){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),"string"==typeof n&&(n=y(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+e.length);if(a.set(n),a.set(e,n.length),a=i(a),a[6]=15&a[6]|t,a[8]=63&a[8]|128,o){r=r||0;for(let e=0;e<16;++e)o[r+e]=a[e];return o}return c(a)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n};var w=v("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o.a.createHash("md5").update(e).digest()}));var b=function(e,t,i){const n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=n[e];return t}return c(n)};var S=v("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o.a.createHash("sha1").update(e).digest()})),D="00000000-0000-0000-0000-000000000000";var x=function(e){if(!d(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(1),r=i(2),a=i(8),s=i(9),l=i(3),d=i(4),u=i(5),c=o.default.require("fs-extra"),g={ContentScriptId:"drawio-content-script",DiagramsCacheFolder:`${d.tmpdir}${u.sep}joplin-drawio-plugin${u.sep}`},f={NewDiagramPng:"drawio-new-diagram-png",NewDiagramSvg:"drawio-new-diagram-svg",NewSketchPng:"drawio-new-sketch-png",NewSketchSvg:"drawio-new-sketch-svg"};o.default.plugins.register({onStart:function(){return n(this,void 0,void 0,(function*(){const e=new a.Settings,t=new s.EditorDialog(e);c.emptyDirSync(g.DiagramsCacheFolder),yield e.register(),o.default.settings.onChange(i=>n(this,void 0,void 0,(function*(){yield e.read(i),t.reset()}))),yield o.default.commands.register({name:f.NewDiagramPng,label:"Create new diagram PNG",iconName:"fa fa-pencil",execute:()=>n(this,void 0,void 0,(function*(){yield t.new(s.EmptyDiagram.PNG)}))}),yield o.default.commands.register({name:f.NewDiagramSvg,label:"Create new diagram SVG",iconName:"fa fa-pencil",execute:()=>n(this,void 0,void 0,(function*(){yield t.new(s.EmptyDiagram.SVG)}))}),yield o.default.commands.register({name:f.NewSketchPng,label:"Create new sketch PNG",iconName:"fa fa-pencil",execute:()=>n(this,void 0,void 0,(function*(){yield t.new(s.EmptyDiagram.PNG,!0)}))}),yield o.default.commands.register({name:f.NewSketchSvg,label:"Create new sketch SVG",iconName:"fa fa-pencil",execute:()=>n(this,void 0,void 0,(function*(){yield t.new(s.EmptyDiagram.SVG,!0)}))});const i=Object.values(f).map(e=>({commandName:e}));yield o.default.views.menus.create("menu-drawio","Draw.io",i,r.MenuItemLocation.Tools),yield o.default.contentScripts.register(r.ContentScriptType.MarkdownItPlugin,g.ContentScriptId,"./contentScript/contentScript.js"),yield o.default.contentScripts.onMessage(g.ContentScriptId,e=>n(this,void 0,void 0,(function*(){switch(console.log("contentScripts.onMessage Input:",e),e.action){case"edit":return yield t.edit(e.diagramId),void(yield o.default.commands.execute("focusElement","noteBody"));case"check":return{isValid:yield l.isDiagramResource(e.diagramId)};default:return"Invalid action: "+e.action}})))}))}})},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Settings=t.SettingDefaults=void 0;const o=i(1),r=i(2);t.SettingDefaults={ui:"kennedy",themeUi:{kennedy:"Kennedy (Default)",min:"Minimal (Small screens and mobile optimized)",atlas:"Atlas (Business oriented)"},languages:{id:"Bahasa Indonesia",ms:"Bahasa Melayu",bs:"Bosanski",ca:"Català",cs:"Čeština",da:"Dansk",de:"Deutsch",et:"Eesti",en:"English",es:"Español",fil:"Filipino",fr:"Français",it:"Italiano",hu:"Magyar",nl:"Nederlands",no:"Norsk",pl:"Polski","pt-br":"Português (Brasil)",pt:"Português (Portugal)",ro:"Română",fi:"Suomi",sv:"Svenska",vi:"Tiếng Việt",tr:"Türkçe",el:"Ελληνικά",ru:"Русский",sr:"Српски",uk:"Українська",he:"עברית",ar:"العربية",th:"ไทย",ko:"한국어",ja:"日本語",zh:"中文 (中国)","zh-tw":"中文 (台灣)"},defaultLanguage:"en",server:"https://embed.diagrams.net/"};t.Settings=class{constructor(){this._config={themeUi:{value:"en",type:r.SettingItemType.String,section:"drawio.settings",public:!0,advanced:!1,isEnum:!0,options:t.SettingDefaults.themeUi,label:"Theme: UI",description:"Control how the buttons and menu are rendered. https://www.diagrams.net/blog/diagram-editor-theme"},themeRough:{value:!0,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"Theme: Rough style",description:"Enable/disable the rough lines style when creating sketch diagrams. https://www.diagrams.net/blog/rough-style.html"},themeDark:{value:!1,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"Theme: Dark mode",description:"Enable/disable the dark mode"},languageUi:{value:t.SettingDefaults.defaultLanguage,type:r.SettingItemType.String,section:"drawio.settings",public:!0,advanced:!1,isEnum:!0,options:t.SettingDefaults.languages,label:"Theme: Language",description:"Set the editor language"},grid:{value:!0,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"View: Grid",description:"Enable/disable the grid"},pageVisible:{value:!0,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"View: Page visible",description:"Show/hide the boundaries of a page"},ruler:{value:!1,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"View: Ruler",description:"Show/hide rulers"},exportGrid:{value:!1,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"Export: Grid",description:"Show/hide grid in the exported picture"},exportShadows:{value:!1,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"Export: Shadows",description:"Show/hide Shadows in the exported picture"},exportTransparentBackground:{value:!0,type:r.SettingItemType.Bool,section:"drawio.settings",public:!0,advanced:!1,label:"Export: Transparent background",description:"Enable/disable the transparent background in the exported picture"},server:{value:t.SettingDefaults.server,type:r.SettingItemType.String,section:"drawio.settings",public:!0,advanced:!0,label:"Connection: Draw.io server",description:"Draw.io server to use. Default value: "+t.SettingDefaults.server}},this._checks={}}get(e){if(e in this._config)return this._config[e].value;throw"Setting not found: "+e}toObject(){return Object.keys(this._config).reduce((e,t)=>(e[t]=this._config[t].value,e),{})}register(){return n(this,void 0,void 0,(function*(){yield o.default.settings.registerSection("drawio.settings",{label:"Draw.io",iconName:"fa fa-pen",description:"Drawio allows you to render and modify diagrams created with draw.io (aka diagrams.net). For more info on the plugin: https://github.com/marc0l92/joplin-plugin-drawio#readme"}),yield o.default.settings.registerSettings(this._config),yield this.read()}))}getOrDefault(e,t,i){return n(this,void 0,void 0,(function*(){return!e||e.keys.includes(i)?yield o.default.settings.value(i):t}))}read(e){return n(this,void 0,void 0,(function*(){for(let t in this._config)this._config[t].value=yield this.getOrDefault(e,this._config[t].value,t),t in this._checks&&(this._config[t].value=this._checks[t](this._config[t].value),yield o.default.settings.setValue(t,this._config[t].value))}))}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EditorDialog=t.EmptyDiagram=void 0;const o=i(1),r=i(3),a=i(6),s="drawio-dialog";function l(e){return`![drawio](:/${e})`}!function(e){e.PNG="data:image/png;base64,",e.SVG="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxcHgiIGhlaWdodD0iMXB4IiB2aWV3Qm94PSIwIDAgMSAxIiBjb250ZW50PSImbHQ7bXhmaWxlIGhvc3Q9JnF1b3Q7ZW1iZWQuZGlhZ3JhbXMubmV0JnF1b3Q7IG1vZGlmaWVkPSZxdW90OzIwMjItMDEtMjRUMDc6Mzk6MTAuMTE3WiZxdW90OyB0eXBlPSZxdW90O2VtYmVkJnF1b3Q7Jmd0OyZsdDtkaWFncmFtIGlkPSZxdW90O0k1RXAxcldJZlc0d0RfNXFQY280JnF1b3Q7IG5hbWU9JnF1b3Q7UGFnZS0xJnF1b3Q7Jmd0O2RaRk5ENE1nRElaL0RYZVV1SSt6Yy9PeWs0ZWRpWFJDZ3BZZ2kyNi9maHB3U3JaZFNIbjZscGUyaE9YdGVMSGN5Q3NLMENTbFlpVHNSTkwwc0Q5TzV3eWVIdXl5eklQR0t1RlJzb0pLdlNCQUd1aERDZWdqb1VQVVRwa1kxdGgxVUx1SWNXdHhpR1YzMUxHcjRVMXdwQ3VvYXE3aFMzWlR3c25RVnJaUmw2QWF1VGduTkdSYXZvZ0Q2Q1VYT0d3UUt3akxMYUx6VVR2bW9PZlpMWFB4ZGVjLzJjL0hMSFR1UjhFVXJHOVBsMmhCckhnRCZsdDsvZGlhZ3JhbSZndDsmbHQ7L214ZmlsZSZndDsiPjxkZWZzLz48Zy8+PC9zdmc+"}(t.EmptyDiagram||(t.EmptyDiagram={}));t.EditorDialog=class{constructor(e){this._handler=null,this._settings=null,this._settings=e}getThemeUi(e){let t="";return e?t="sketch":(t=this._settings.get("themeUi"),!0===this._settings.get("themeDark")&&"kennedy"===t&&(t="dark")),t}buildDialogHTML(e,t){return`\n            <form name="main">\n                <a href="#" onclick="startDrawio()">Click here to load draw.io if it does not start automatically...</a>\n                <input type="hidden" id="settings" value='${JSON.stringify(this._settings.toObject())}' />\n                <input type="hidden" id="setting-theme-ui" value='${t}' />\n                <input type="hidden" id="diagram" name="diagram" value="${e}">\n            </form>\n            `}init(){return n(this,void 0,void 0,(function*(){this._handler||(this._handler=yield o.default.views.dialogs.create(`${s}-${a.v4()}`),yield o.default.views.dialogs.setFitToContent(this._handler,!1),yield o.default.views.dialogs.addScript(this._handler,"./dialog/DiagramEditor.js"),yield o.default.views.dialogs.addScript(this._handler,"./dialog/bootstrap.js"),yield o.default.views.dialogs.addScript(this._handler,"./dialog/drawioEmbed.js"),yield o.default.views.dialogs.setButtons(this._handler,[{id:"ok",title:"Save"},{id:"cancel",title:"Close"}]))}))}reset(){return n(this,void 0,void 0,(function*(){this._handler=null}))}new(e,t=!1){return n(this,void 0,void 0,(function*(){this._handler||(yield this.init());const i=this.getThemeUi(t);yield o.default.views.dialogs.setHtml(this._handler,this.buildDialogHTML(e,i));const n=yield o.default.views.dialogs.open(this._handler);if(console.log("dialogResult",n),"ok"===n.id){const e=yield r.createDiagramResource(n.formData.main.diagram,{sketch:t});yield o.default.commands.execute("insertText",l(e))}}))}edit(e){return n(this,void 0,void 0,(function*(){this._handler||(yield this.init());const t=yield r.getDiagramResource(e),i=this.getThemeUi(t.options.sketch);yield o.default.views.dialogs.setHtml(this._handler,this.buildDialogHTML(t.body,i));const n=yield o.default.views.dialogs.open(this._handler);if(console.log("dialogResult",n),"ok"===n.id){const i=yield r.updateDiagramResource(e,n.formData.main.diagram,t.options),a=yield o.default.workspace.selectedNote();if(a){const t=a.body.replace(new RegExp(`!\\[drawio\\]\\(:\\/${e}\\)`,"gi"),l(i));yield o.default.data.put(["notes",a.id],null,{body:t}),yield o.default.commands.execute("editor.setText",t)}}}))}}}]);