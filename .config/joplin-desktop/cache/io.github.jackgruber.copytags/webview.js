!function(e){var t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(a,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function i(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1);new class{constructor(){this.autocompleteCurrentFocus=-1,this.setCheckboxIndeterminate(),this.setOnClickEventTagAllCheckBox(),this.setSearchBoxEvent(),this.storeAllTags(),this.setFocus(),document.addEventListener("click",e=>{this.removeAutocompleteItems()})}debounce(e,t=300){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(this,s)},t)}}storeAllTags(){this.allTagsIds=[];const e=document.getElementById("assignedTags").getElementsByTagName("input");for(const t of e)"checkbox"==t.getAttribute("type")&&this.allTagsIds.push(t.getAttribute("tagId"))}setSearchBoxEvent(){const e=document.getElementById("query-input");document.addEventListener("input",this.debounce((function(t){""===e.value.trim()?this.clearSearchField():this.searchTag(e.value)}),250)),e.addEventListener("keydown",e=>{this.navigateAutocompleteList(e)})}navigateAutocompleteList(e){let t=document.getElementById("autocomplete-list");if(!t)return;let n=t.getElementsByTagName("div");switch(e.key){case"Up":case"Down":case"ArrowUp":case"ArrowDown":this.autocompleteCurrentFocus="ArrowUp"===e.key||"Up"===e.key?this.autocompleteCurrentFocus-1:this.autocompleteCurrentFocus+1,this.markActive(n);break;case"Enter":e.preventDefault(),-1===this.autocompleteCurrentFocus?n[0].click():n[this.autocompleteCurrentFocus].click()}}removeActive(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}markActive(e){if(!e)return!1;this.removeActive(e),this.autocompleteCurrentFocus>=e.length&&(this.autocompleteCurrentFocus=0),this.autocompleteCurrentFocus<0&&(this.autocompleteCurrentFocus=e.length-1),e[this.autocompleteCurrentFocus].classList.add("autocomplete-active")}setCheckboxIndeterminate(){const e=document.getElementsByClassName("indeterminate");for(let t=0;t<e.length;t++)e[t].indeterminate=!0}toggleTagCheckbox(e){const t=e.target.parentNode.getElementsByClassName("tagcheckbox")[0],n=t.getAttribute("tagId"),s=document.getElementsByName(n)[0];return-1!==t.className.indexOf("indeterminate")?1==t.value?(t.indeterminate=!0,t.checked=!1,t.value=2,s.setAttribute("value","2")):2==t.value?(t.indeterminate=!1,t.checked=!1,t.value=0,s.setAttribute("value","0")):(t.indeterminate=!1,t.checked=!0,t.value=1,s.setAttribute("value","1")):1==t.value?(t.checked=!1,t.value=0,s.setAttribute("value","0")):(t.checked=!0,t.value=1,s.setAttribute("value","1")),!1}setOnClickEventTagAllCheckBox(){const e=document.getElementsByClassName("tag");for(let t=0;t<e.length;t++)this.setOnClickEvenForCheckbox(e[t].getElementsByTagName("input")[0]),this.setOnClickEvenForCheckbox(e[t].getElementsByTagName("label")[0])}setOnClickEvenForCheckbox(e){e.addEventListener("click",e=>{this.toggleTagCheckbox(e)})}searchTag(e){return s(this,void 0,void 0,(function*(){this.searchText=e,this.resultMessage=yield webviewApi.postMessage({type:"tagSearch",query:this.searchText,exclude:this.allTagsIds}),this.showTagSearch()}))}showTagSearch(){const e=document.getElementById("autocomplete");let t=!0;if(this.removeAutocompleteItems(),this.autocompleteCurrentFocus=-1,this.resultMessage){const n=document.createElement("div");n.setAttribute("class","autocomplete-items"),n.setAttribute("id","autocomplete-list"),e.appendChild(n);for(const e of this.resultMessage.result){const s=document.createElement("div"),a=this.searchText.trim().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp("("+a+")","i"),o=e.title.replace(r,"<b>$1</b>");s.setAttribute("tagId",e.id),s.setAttribute("tagTitle",e.title),s.innerHTML=o,s.addEventListener("click",e=>{this.selectTag(e)}),n.appendChild(s),e.title.toLowerCase()===this.searchText.trim().toLowerCase()&&(t=!1)}const s=this.searchText.trim();if(!0===t&&-1===this.allTagsIds.indexOf("new_"+s)){const e=document.createElement("div");e.setAttribute("tagId","new"),e.setAttribute("tagTitle",s),e.innerHTML="<strong>Create tag:</strong> "+s,e.addEventListener("click",e=>{this.selectTag(e)}),n.insertBefore(e,n.firstChild)}}}selectTag(e){const t=e.target,n=t.getAttribute("tagId"),s=t.getAttribute("tagTitle");this.clearSearchField(),this.addTag(n,s)}clearSearchField(){this.removeAutocompleteItems();document.getElementById("query-input").value="",this.searchText=""}removeAutocompleteItems(){const e=document.getElementsByClassName("autocomplete-items");this.autocompleteCurrentFocus=-1;for(const t of e)t.parentNode.removeChild(t)}setFocus(){document.getElementById("query-input").focus()}addTag(e,t){const n=document.getElementById("assignedTags");document.createElement("label").innerHTML=t,"new"==e&&(e="new_"+t),this.allTagsIds.push(e);const s=a.htmlToElem(a.createTagHTML(e,1,t));n.appendChild(s);const r=n.getElementsByClassName("tag");this.setOnClickEvenForCheckbox(r[r.length-1].getElementsByTagName("input")[0]),this.setOnClickEvenForCheckbox(r[r.length-1].getElementsByTagName("label")[0])}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTagHTML=t.htmlToElem=void 0,t.htmlToElem=function(e){let t=document.createElement("template");return t.innerHTML=e,t.content.firstChild},t.createTagHTML=function(e,t,n){const s=document.createElement("div"),a=document.createElement("input"),r=document.createElement("span"),o=document.createElement("input"),i=document.createElement("label");return s.setAttribute("class","tag"),i.innerHTML=n,a.setAttribute("type","checkbox"),a.setAttribute("tagId",e),a.setAttribute("value",t.toString()),a.classList.add("tagcheckbox"),1==t?a.defaultChecked=!0:2==t&&a.classList.add("indeterminate"),r.setAttribute("class","checkmark"),o.setAttribute("type","hidden"),o.setAttribute("name",e),o.setAttribute("value",t.toString()),s.appendChild(a),s.appendChild(r),s.appendChild(i),s.appendChild(o),s.outerHTML}}]);