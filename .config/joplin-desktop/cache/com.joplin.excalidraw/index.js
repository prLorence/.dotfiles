!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=joplin},function(e,t,n){"use strict";n.r(t),n.d(t,"v1",(function(){return g})),n.d(t,"v3",(function(){return h})),n.d(t,"v4",(function(){return S})),n.d(t,"v5",(function(){return T})),n.d(t,"NIL",(function(){return D})),n.d(t,"version",(function(){return M})),n.d(t,"validate",(function(){return u})),n.d(t,"stringify",(function(){return f})),n.d(t,"parse",(function(){return w}));var i=n(0),o=n.n(i);const r=new Uint8Array(256);let a=r.length;function l(){return a>r.length-16&&(o.a.randomFillSync(r),a=0),r.slice(a,a+=16)}var d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;var u=function(e){return"string"==typeof e&&d.test(e)};const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function s(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}var f=function(e,t=0){const n=s(e,t);if(!u(n))throw TypeError("Stringified UUID is invalid");return n};let p,y,v=0,m=0;var g=function(e,t,n){let i=t&&n||0;const o=t||new Array(16);let r=(e=e||{}).node||p,a=void 0!==e.clockseq?e.clockseq:y;if(null==r||null==a){const t=e.random||(e.rng||l)();null==r&&(r=p=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==a&&(a=y=16383&(t[6]<<8|t[7]))}let d=void 0!==e.msecs?e.msecs:Date.now(),u=void 0!==e.nsecs?e.nsecs:m+1;const c=d-v+(u-m)/1e4;if(c<0&&void 0===e.clockseq&&(a=a+1&16383),(c<0||d>v)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=d,m=u,y=a,d+=122192928e5;const f=(1e4*(268435455&d)+u)%4294967296;o[i++]=f>>>24&255,o[i++]=f>>>16&255,o[i++]=f>>>8&255,o[i++]=255&f;const g=d/4294967296*1e4&268435455;o[i++]=g>>>8&255,o[i++]=255&g,o[i++]=g>>>24&15|16,o[i++]=g>>>16&255,o[i++]=a>>>8|128,o[i++]=255&a;for(let e=0;e<6;++e)o[i+e]=r[e];return t||s(o)};var w=function(e){if(!u(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function x(e,t,n){function i(e,i,o,r){var a;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof i&&(i=w(i)),16!==(null===(a=i)||void 0===a?void 0:a.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+e.length);if(l.set(i),l.set(e,i.length),l=n(l),l[6]=15&l[6]|t,l[8]=63&l[8]|128,o){r=r||0;for(let e=0;e<16;++e)o[r+e]=l[e];return o}return s(l)}try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}var h=x("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o.a.createHash("md5").update(e).digest()})),b={randomUUID:o.a.randomUUID};var S=function(e,t,n){if(b.randomUUID&&!t&&!e)return b.randomUUID();const i=(e=e||{}).random||(e.rng||l)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return s(i)};var T=x("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o.a.createHash("sha1").update(e).digest()})),D="00000000-0000-0000-0000-000000000000";var M=function(e){if(!u(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function l(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}d((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),r=n(2),a=n(4),l=n(5),d=n(6),u="excalidraw-script";let c,s,f,p;const y=()=>i(void 0,void 0,void 0,(function*(){c&&!p&&(yield o.default.views.panels.postMessage(c,{message:"excalidraw_close"}),yield o.default.views.panels.hide(c),p=!0)})),v=()=>i(void 0,void 0,void 0,(function*(){c=yield i(void 0,void 0,void 0,(function*(){const e=yield o.default.views.panels.create("excalidraw-"+r.v4());return yield o.default.views.panels.onMessage(e,w),yield o.default.views.panels.setHtml(e,'<div class="container" id="excalidraw">Hello Excalidraw!!!</div>'),yield o.default.views.panels.addScript(e,"./webview/index.js"),yield o.default.views.panels.addScript(e,"./webview/index.css"),e}));const e=yield l.parseData(s.body);yield new Promise(e=>setTimeout(()=>e(),500)),yield o.default.views.panels.postMessage(c,{message:"excalidraw_init",options:e}),yield o.default.views.panels.show(c),p=!1})),m=()=>i(void 0,void 0,void 0,(function*(){p?yield g():yield y()})),g=()=>i(void 0,void 0,void 0,(function*(){f=!0,yield y(),s=yield o.default.workspace.selectedNote(),console.log("test"),l.isExcalidraw(null==s?void 0:s.body)&&(yield v()),f=!1})),w=e=>i(void 0,void 0,void 0,(function*(){"excalidraw_sync"===e.message&&(({jsonData:e})=>{i(void 0,void 0,void 0,(function*(){l.isExcalidraw(null==s?void 0:s.body)&&!f&&(s.body=l.replaceData(s.body,JSON.stringify(e)),yield o.default.commands.execute("editor.setText",s.body),yield o.default.data.put(["notes",s.id],null,{body:s.body}))}))})(e)}));const x=(e,t)=>i(void 0,void 0,void 0,(function*(){let n="{}";const i=yield o.default.plugins.installationDir();if(!t){n=(yield d.getDiagramResource(e)).dataJson}let a=o.default.views.dialogs,l=yield a.create("excalidraw-dialog-"+r.v4()),u=(e=>`\n\t\t<form name="main" style="display:none">\n\t\t\t<input type="" name="excalidraw_diagram_json"  id="excalidraw_diagram_json" value='${e}'>\n\t\t</form>\n\t\t`)(n),c=`<iframe id="excalidraw_iframe" style="position:absolute;border:0;width:100%;height:100%;" src="${i}\\local-excalidraw\\index.html" title="description"></iframe>`;yield a.setHtml(l,u+c),yield a.setButtons(l,[{id:"ok",title:"Save"},{id:"cancel",title:"Close"}]),yield a.setFitToContent(l,!1);let s=yield a.open(l);"ok"===s.id&&(t?(e=yield d.createDiagramResource(s.formData.main.excalidraw_diagram_json),yield o.default.commands.execute("insertText",function(e){return`![excalidraw](excalidraw://${e})`}(e))):yield d.updateDiagramResource(e,s.formData.main.excalidraw_diagram_json))}));o.default.plugins.register({onStart:()=>i(void 0,void 0,void 0,(function*(){d.clearDiskCache(),yield o.default.contentScripts.register(a.ContentScriptType.MarkdownItPlugin,u,"./contentScript.js"),yield o.default.contentScripts.onMessage(u,e=>{x(e,!1)}),yield o.default.commands.register({name:"addExcalidraw",label:"add excalidraw panel",iconName:"fa fa-palette",execute:()=>i(void 0,void 0,void 0,(function*(){x("",!0)}))}),yield o.default.views.toolbarButtons.create("addExcalidraw","addExcalidraw",a.ToolbarButtonLocation.EditorToolbar),yield o.default.commands.register({name:"switchExcalidraw",label:"switch excalidraw panel",iconName:"fa fa-palette",execute:m}),yield o.default.views.toolbarButtons.create("switchExcalidraw","switchExcalidraw",a.ToolbarButtonLocation.NoteToolbar),yield o.default.workspace.onNoteSelectionChange(g)}))})},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentScriptType=t.SettingStorage=t.AppType=t.SettingItemSubType=t.SettingItemType=t.ToolbarButtonLocation=t.isContextMenuItemLocation=t.MenuItemLocation=t.ModelType=t.ImportModuleOutputFormat=t.FileSystemItem=void 0,function(e){e.File="file",e.Directory="directory"}(t.FileSystemItem||(t.FileSystemItem={})),function(e){e.Markdown="md",e.Html="html"}(t.ImportModuleOutputFormat||(t.ImportModuleOutputFormat={})),function(e){e[e.Note=1]="Note",e[e.Folder=2]="Folder",e[e.Setting=3]="Setting",e[e.Resource=4]="Resource",e[e.Tag=5]="Tag",e[e.NoteTag=6]="NoteTag",e[e.Search=7]="Search",e[e.Alarm=8]="Alarm",e[e.MasterKey=9]="MasterKey",e[e.ItemChange=10]="ItemChange",e[e.NoteResource=11]="NoteResource",e[e.ResourceLocalState=12]="ResourceLocalState",e[e.Revision=13]="Revision",e[e.Migration=14]="Migration",e[e.SmartFilter=15]="SmartFilter",e[e.Command=16]="Command"}(t.ModelType||(t.ModelType={})),function(e){e.File="file",e.Edit="edit",e.View="view",e.Note="note",e.Tools="tools",e.Help="help",e.Context="context",e.NoteListContextMenu="noteListContextMenu",e.EditorContextMenu="editorContextMenu",e.FolderContextMenu="folderContextMenu",e.TagContextMenu="tagContextMenu"}(i=t.MenuItemLocation||(t.MenuItemLocation={})),t.isContextMenuItemLocation=function(e){return[i.Context,i.NoteListContextMenu,i.EditorContextMenu,i.FolderContextMenu,i.TagContextMenu].includes(e)},function(e){e.NoteToolbar="noteToolbar",e.EditorToolbar="editorToolbar"}(t.ToolbarButtonLocation||(t.ToolbarButtonLocation={})),function(e){e[e.Int=1]="Int",e[e.String=2]="String",e[e.Bool=3]="Bool",e[e.Array=4]="Array",e[e.Object=5]="Object",e[e.Button=6]="Button"}(t.SettingItemType||(t.SettingItemType={})),function(e){e.FilePathAndArgs="file_path_and_args",e.FilePath="file_path",e.DirectoryPath="directory_path"}(t.SettingItemSubType||(t.SettingItemSubType={})),function(e){e.Desktop="desktop",e.Mobile="mobile",e.Cli="cli"}(t.AppType||(t.AppType={})),function(e){e[e.Database=1]="Database",e[e.File=2]="File"}(t.SettingStorage||(t.SettingStorage={})),function(e){e.MarkdownItPlugin="markdownItPlugin",e.CodeMirrorPlugin="codeMirrorPlugin"}(t.ContentScriptType||(t.ContentScriptType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isolateData=t.replaceData=t.parseData=t.hasData=t.isExcalidraw=void 0;t.isExcalidraw=e=>null!=e&&e.toLocaleLowerCase().includes("```excalidraw```"),t.hasData=e=>null!=e&&e.toLocaleLowerCase().includes("excalidraw-data"),t.parseData=e=>{const n=t.isolateData(e);if(n){return n?JSON.parse(n):null}return{}},t.replaceData=(e,n)=>{const i=e;if(!t.hasData(e))return i+"\n\n```excalidraw-data\n\n"+n;return i.split("```excalidraw-data")[0]+"```excalidraw-data\n\n"+n},t.isolateData=e=>t.hasData(e)?e.split("excalidraw-data")[1].replace("\n","").trim():""},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function l(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}d((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isDiagramResource=t.createDiagramResource=t.updateDiagramResource=t.getDiagramResource=t.clearDiskCache=void 0;const o=n(1),r=n(2),a=n(7),l=n(8),d=o.default.require("fs-extra"),u={TempFolder:`${a.tmpdir}${l.sep}joplin-excalidraw-plugin${l.sep}`,TitlePrefix:"excalidraw-"};function c(e){return u.TitlePrefix+Date.parse((new Date).toString())}function s(e,t,n=null){return i(this,void 0,void 0,(function*(){return n||(n=`${u.TempFolder}${e}.json`),n+=c(),yield d.writeFile(n,t),n}))}t.clearDiskCache=function(){d.rmdirSync(u.TempFolder,{recursive:!0}),d.mkdirSync(u.TempFolder,{recursive:!0})},t.getDiagramResource=function(e){return i(this,void 0,void 0,(function*(){let t=yield o.default.data.get(["resources",e,"file"]);return{body:"",dataJson:(new TextDecoder).decode(t.body)}}))},t.updateDiagramResource=function(e,t){return i(this,void 0,void 0,(function*(){let n=yield s(e,t);return yield o.default.data.put(["resources",e],null,{title:c()},[{path:n}]),e}))},t.createDiagramResource=function(e){return i(this,void 0,void 0,(function*(){let t=r.v4().replace(/-/g,""),n=yield s(t,e);return yield o.default.data.post(["resources"],null,{id:t,title:c()},[{path:n}]),t}))},t.isDiagramResource=function(e){return i(this,void 0,void 0,(function*(){return(yield o.default.data.get(["resources",e])).title.startsWith(u.TitlePrefix)}))}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")}]);