(()=>{"use strict";var e={775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=joplin},200:(e,t)=>{var i,o,n,a,r,s,u,d,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentScriptType=t.SettingStorage=t.AppType=t.SettingItemSubType=t.SettingItemType=t.ToolbarButtonLocation=t.isContextMenuItemLocation=t.MenuItemLocation=t.ModelType=t.ImportModuleOutputFormat=t.FileSystemItem=void 0,(c=t.FileSystemItem||(t.FileSystemItem={})).File="file",c.Directory="directory",(l=t.ImportModuleOutputFormat||(t.ImportModuleOutputFormat={})).Markdown="md",l.Html="html",(d=t.ModelType||(t.ModelType={}))[d.Note=1]="Note",d[d.Folder=2]="Folder",d[d.Setting=3]="Setting",d[d.Resource=4]="Resource",d[d.Tag=5]="Tag",d[d.NoteTag=6]="NoteTag",d[d.Search=7]="Search",d[d.Alarm=8]="Alarm",d[d.MasterKey=9]="MasterKey",d[d.ItemChange=10]="ItemChange",d[d.NoteResource=11]="NoteResource",d[d.ResourceLocalState=12]="ResourceLocalState",d[d.Revision=13]="Revision",d[d.Migration=14]="Migration",d[d.SmartFilter=15]="SmartFilter",d[d.Command=16]="Command",function(e){e.File="file",e.Edit="edit",e.View="view",e.Note="note",e.Tools="tools",e.Help="help",e.Context="context",e.NoteListContextMenu="noteListContextMenu",e.EditorContextMenu="editorContextMenu",e.FolderContextMenu="folderContextMenu",e.TagContextMenu="tagContextMenu"}(i=t.MenuItemLocation||(t.MenuItemLocation={})),t.isContextMenuItemLocation=function(e){return[i.Context,i.NoteListContextMenu,i.EditorContextMenu,i.FolderContextMenu,i.TagContextMenu].includes(e)},(u=t.ToolbarButtonLocation||(t.ToolbarButtonLocation={})).NoteToolbar="noteToolbar",u.EditorToolbar="editorToolbar",(s=t.SettingItemType||(t.SettingItemType={}))[s.Int=1]="Int",s[s.String=2]="String",s[s.Bool=3]="Bool",s[s.Array=4]="Array",s[s.Object=5]="Object",s[s.Button=6]="Button",(r=t.SettingItemSubType||(t.SettingItemSubType={})).FilePathAndArgs="file_path_and_args",r.FilePath="file_path",r.DirectoryPath="directory_path",(a=t.AppType||(t.AppType={})).Desktop="desktop",a.Mobile="mobile",a.Cli="cli",(n=t.SettingStorage||(t.SettingStorage={}))[n.Database=1]="Database",n[n.File=2]="File",(o=t.ContentScriptType||(t.ContentScriptType={})).MarkdownItPlugin="markdownItPlugin",o.CodeMirrorPlugin="codeMirrorPlugin"},589:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0;const n=i(775),a=n.default.require("fs-extra");class r{constructor(e){this.tmpdir=e.tmpdir,this.resourceId=e.resourceId,this.mime=e.mime,this.title=e.title,this.fileExt=e.fileExt,this.tempfilePath=e.tempfilePath}getDataAsString(e="utf8"){return o(this,void 0,void 0,(function*(){const t=yield n.default.data.get(["resources",this.resourceId,"file"]);return Buffer.from(t.body).toString(e)}))}updateData(e){return o(this,void 0,void 0,(function*(){this.tempfilePath&&(yield a.rm(this.tempfilePath),this.tempfilePath=null);const t=yield this.tmpdir.newFile(e,this.fileExt),i=[{path:t}],o={mime:this.mime,title:this.title,file_extension:this.fileExt?/^[.]?(.*)$/.exec(this.fileExt)[1]:null};yield n.default.data.put(["resources",this.resourceId],null,o,i),this.tempfilePath=t}))}htmlSafeTitle(){return this.title.replace(/[&]/g,"&amp;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;").replace(/["]/g,"&quot;").replace(/[']/g,"&#39;")}static fromURL(e,t,i,a){var s;return o(this,void 0,void 0,(function*(){const o=/^file:\/\/.*\/([a-zA-Z0-9]+)[.]\w+(?:[?#]|$)/.exec(t),u=/^:\/[a-zA-Z0-9]+$/.exec(t);let d;if(o?d=o[1]:u&&(d=u[1]),!d)return null;const l=yield n.default.data.get(["resources",d]);return l?new r({tmpdir:e,resourceId:l.id,mime:null!==(s=l.mime)&&void 0!==s?s:a,title:l.title,fileExt:i,tempfilePath:null}):null}))}static ofData(e,t,i,a){return o(this,void 0,void 0,(function*(){const o={title:i.endsWith(a)?i:`${i}${a}`},s=[{path:yield e.newFile(t,a)}],u=yield n.default.data.post(["resources"],null,o,s);return new r({tmpdir:e,resourceId:u.id,mime:u.mime,title:u.title,fileExt:a})}))}}t.Resource=r,t.default=r},333:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(775),a=i(37),r=i(17),s=n.default.require("fs-extra"),u=[];class d{constructor(e){this.path=e,this.fileIdCounter=0,u.push(this)}nextFilepath(e=""){return this.fileIdCounter++,r.join(this.path,`tmp${this.fileIdCounter}${null!=e?e:""}`)}newFile(e,t=""){return o(this,void 0,void 0,(function*(){const i=this.nextFilepath(t),o=yield s.open(i,"w");return yield s.writeFile(o,e),yield s.close(o),i}))}destroySync(){this.path&&(s.rmSync(this.path,{recursive:!0}),this.path=null)}static create(){return o(this,void 0,void 0,(function*(){const e=yield s.mkdtemp(r.join((0,a.tmpdir)(),"joplin-js-draw"));return new d(e)}))}}t.default=d,process.on("exit",(()=>{for(const e of u)e.destroySync()}))},595:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getAutosave=t.hasAutosave=t.clearAutosave=t.autosave=void 0;const n=i(775),a=i(17),r=n.default.require("fs-extra"),s=()=>o(void 0,void 0,void 0,(function*(){const e=yield n.default.plugins.dataDir();return a.join(e,"autosaves")})),u="autosave.svg";t.autosave=e=>o(void 0,void 0,void 0,(function*(){const t=yield o(void 0,void 0,void 0,(function*(){const e=yield s();return(yield r.pathExists(e))||(yield r.mkdir(e)),e}));yield r.writeFile(a.join(t,u),e)})),t.clearAutosave=()=>o(void 0,void 0,void 0,(function*(){const e=yield s();(yield r.pathExists(e))&&(yield r.remove(e))})),t.hasAutosave=()=>o(void 0,void 0,void 0,(function*(){const e=yield s();return!!(yield r.pathExists(a.join(e,u)))})),t.getAutosave=()=>o(void 0,void 0,void 0,(function*(){if(yield(0,t.hasAutosave)()){const e=yield s();return yield r.readFile(a.join(e,u),"utf-8")}return null}))},607:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(775),a=i(200),r=i(595),s=i(843),u=i(589),d=i(333),l=n.default.views.dialogs,c=(e,t)=>o(void 0,void 0,void 0,(function*(){var i;yield(i=e,o(void 0,void 0,void 0,(function*(){yield l.setButtons(i,[{id:"cancel"}]),yield l.setHtml(i,""),yield l.addScript(i,"./dialog/webview.js"),yield l.addScript(i,"./dialog/webview.css"),yield l.setFitToContent(i,!1)})));const a=new Promise(((i,o)=>{let a=null;n.default.views.panels.onMessage(e,(i=>{if("saveSVG"===i.type)a=i.data,l.setButtons(e,[{id:"ok"}]);else{if("getInitialData"===i.type)return l.setButtons(e,[]),t;"showCloseUnsavedBtn"===i.type?l.setButtons(e,[{id:"cancel",title:s.default.discardChanges}]):"hideCloseUnsavedBtn"===i.type?l.setButtons(e,[]):"autosave"===i.type&&(0,r.clearAutosave)().then((()=>{(0,r.autosave)(i.data)}))}})),l.open(e).then((e=>{var t,n,r;if(a&&"ok"===e.id){const o=null!==(r=null===(n=null===(t=e.formData)||void 0===t?void 0:t.saveOptions)||void 0===n?void 0:n.saveOption)&&void 0!==r?r:"saveAsCopy";i([a,o])}else"cancel"===e.id?o("Canceled by user."):o(`Unknown button ID ${e.id}`)}))}));return yield a})),f="jop-freehand-drawing-jsdraw-plugin-";n.default.plugins.register({onStart:function(){return o(this,void 0,void 0,(function*(){const e=yield l.create(`${f}jsDrawDialog`),t=yield d.default.create(),i=e=>o(this,void 0,void 0,(function*(){const i=yield u.default.ofData(t,e,s.default.defaultImageTitle,".svg");yield n.default.commands.execute("insertText",`![${i.htmlSafeTitle()}](:/${i.resourceId})`)})),v=`${f}insertDrawing`;yield n.default.commands.register({name:v,label:s.default.insertDrawing,iconName:"fas fa-pen-alt",execute:()=>o(this,void 0,void 0,(function*(){const[t,o]=yield c(e);yield i(t)}))}),yield n.default.views.toolbarButtons.create(v,v,a.ToolbarButtonLocation.EditorToolbar);const h=`${f}restoreAutosave`,g=`${f}deleteAutosave`;yield n.default.commands.register({name:h,label:s.default.restoreFromAutosave,iconName:"fas fa-floppy-disk",execute:()=>o(this,void 0,void 0,(function*(){const e=yield(0,r.getAutosave)();e?yield i(e):yield n.default.views.dialogs.showMessageBox(s.default.noSuchAutosaveExists)}))}),yield n.default.commands.register({name:g,label:s.default.deleteAutosave,iconName:"fas fa-trash-can",execute:()=>o(this,void 0,void 0,(function*(){yield(0,r.clearAutosave)()}))});const p=n=>o(this,void 0,void 0,(function*(){const o=yield u.default.fromURL(t,n,".svg","image/svg+xml"),[a,r]=yield c(e,yield o.getDataAsString());return"overwrite"===r?(console.log("Overwriting with",a),yield o.updateData(a)):yield i(a),o})),m="jsdraw__markdownIt_editDrawingButton";yield n.default.contentScripts.register(a.ContentScriptType.MarkdownItPlugin,m,"./contentScripts/markdownIt.js"),yield n.default.contentScripts.onMessage(m,(e=>o(this,void 0,void 0,(function*(){return(yield p(e)).resourceId}))))}))}})},843:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const i={insertDrawing:"Insert Drawing",restoreFromAutosave:"Restore from autosaved drawing",deleteAutosave:"Delete all autosaved drawings",noSuchAutosaveExists:"No autosave exists",discardChanges:"Discard changes",defaultImageTitle:"Freehand Drawing",edit:"Edit",close:"Close",save:"Save",overwriteExisting:"Overwrite existing",saveAsNewDrawing:"Save as a new drawing",clickOkToContinue:"Done! Click “Ok” to continue.",discardUnsavedChanges:"Discard unsaved changes?",resumeEditing:"Resume editing"},o={de:Object.assign(Object.assign({},i),{insertDrawing:"Zeichnung einfügen",restoreFromAutosave:"Automatische Sicherung wiederherstellen",deleteAutosave:"Alle automatischen Sicherungen löschen",noSuchAutosaveExists:"Keine automatischen Sicherungen vorhanden",discardChanges:"Änderungen verwerfen",defaultImageTitle:"Freihand-Zeichnen",edit:"Bearbeiten",close:"Schließen",save:"Speichern",overwriteExisting:"Existierende Zeichnung überschreiben",saveAsNewDrawing:"Als neue Zeichnung speichern",clickOkToContinue:"Fertig! Klicke auf „Ok“ um fortzufahen.",discardUnsavedChanges:"Ungespeicherte Änderungen verwerfen?",resumeEditing:"Bearbeiten fortfahren"}),en:i,es:Object.assign(Object.assign({},i),{insertDrawing:"Añada dibujo",restoreFromAutosave:"Resturar al autoguardado",deleteAutosave:"Borrar el autoguardado",noSuchAutosaveExists:"No autoguardado existe",discardChanges:"Descartar cambios",defaultImageTitle:"Dibujo",edit:"Editar",close:"Cerrar",save:"Guardar",overwriteExisting:"Sobrescribir existente",saveAsNewDrawing:"Guardar como dibujo nuevo",clickOkToContinue:"Guardado. Ponga «ok» para continuar.",discardUnsavedChanges:"¿Descartar cambios no guardados?",resumeEditing:"Continuar editando"})};let n;const a=[...navigator.languages];for(const e of navigator.languages){const t=e.indexOf("-");-1!==t&&a.push(e.substring(0,t))}for(const e of a)if(e in o){n=o[e];break}n||(console.log("No supported localization found. Falling back to default."),n=i),t.default=n},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")}},t={};!function i(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,i),a.exports}(607)})();